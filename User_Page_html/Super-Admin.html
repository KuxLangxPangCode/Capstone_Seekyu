<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeekYu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="bulletin-announce.js"></script>
    <style>
        .sidebar { transition: all 0.3s ease; }
        .sidebar-item.active { background-color: #3b82f6; color: white; }
        .sidebar-item.active:hover { background-color: #2563eb; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .calendar-grid { grid-template-columns: repeat(7, 1fr); }
        .day-cell { height: 2.25rem; display:flex; align-items:center; justify-content:center; }
        /* Modal backdrop */
        .modal-backdrop { background: rgba(15, 23, 42, 0.6); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex">
    <!-- Sidebar -->
    <div class="sidebar bg-gray-800 text-white w-64 min-h-screen flex flex-col">
        <!-- Logo & Profile -->
        <div class="p-5 border-b border-gray-700">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <i class="fas fa-shield-alt text-blue-400 text-2xl mr-3"></i>
                    <span class="text-xl font-semibold">SeekYu</span>
                </div>
                <button id="sidebar-toggle" class="text-gray-400 hover:text-white lg:hidden" title="Close sidebar menu">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Profile block -->
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <img id="profilePic" src="https://i.pravatar.cc/100?img=3" alt="Profile" class="w-14 h-14 rounded-full object-cover border-2 border-gray-700"/>
                    <button id="editProfileBtn" title="Edit profile" class="absolute bottom-0 right-0 bg-gray-700 hover:bg-gray-600 p-1 rounded-full text-xs">
                        <i class="fas fa-pen"></i>
                    </button>
                </div>
                <div>
                    <div id="profileName" class="text-sm font-semibold">Miles P. Pirater</div>
                    <div id="profileRole" class="text-xs text-gray-300 mt-1">HR</div>
                    <button id="editProfileSmall" class="text-xs text-gray-300 hover:text-white mt-1">Edit profile</button>
                </div>
            </div>

            <!-- hidden file input for changing avatar (kept for quick avatar change in modal too) -->
            <input id="profileFile" type="file" accept="image/*" class="hidden" />
        </div>
        
        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-4">
            <div class="px-4 space-y-1">
                <div class="text-gray-400 text-xs uppercase tracking-wider font-medium px-4 mb-3">Main Menu</div>
                
                <button onclick="showSection('dashboard')" class="sidebar-item active w-full text-left flex items-center px-4 py-3 text-gray-200 hover:bg-gray-700 rounded-lg group">
                    <i class="fas fa-home mr-3 text-lg text-blue-400"></i>
                    <span>Dashboard</span>
                </button>
                
                <button onclick="showSection('accounts')" class="sidebar-item w-full text-left flex items-center px-4 py-3 text-gray-200 hover:bg-gray-700 rounded-lg group">
                    <i class="fas fa-user-cog mr-3 text-lg text-purple-400"></i>
                    <span>Account Management</span>
                </button>
                
                <!-- <button onclick="showSection('recruiting-mgmt')" class="sidebar-item w-full text-left flex items-center px-4 py-3 text-gray-200 hover:bg-gray-700 rounded-lg group">
                    <i class="fas fa-comment mr-3 text-lg text-indigo-400"></i>
                    <span>Recruitment Management</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">3</span>
                </button> -->
                
                <button onclick="showSection('messaging-mgmt')" class="sidebar-item w-full text-left flex items-center px-4 py-3 text-gray-200 hover:bg-gray-700 rounded-lg group">
                    <i class="fas fa-comment mr-3 text-lg text-indigo-400"></i>
                    <span>Send Message</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">3</span>
                </button> 
            </div>
            

            <div class="px-4 space-y-1 mt-8">
                <div class="text-gray-400 text-xs uppercase tracking-wider font-medium px-4 mb-3">Reports & Analytics</div>

                    <button onclick="showSection('user-activity')" class="sidebar-item w-full text-left flex items-center px-4 py-3 text-gray-200 hover:bg-gray-700 rounded-lg group">
                    <i class="fas fa-comment mr-3 text-lg text-indigo-400"></i>
                    <span>View User Activity</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">3</span>
                </button>
            </div>
        </nav>
        
        <!-- Logout Button -->
        <div class="p-4 border-t border-gray-700">
            <button onclick="location.href='Index.html'" class="w-full flex items-center justify-center px-4 py-3 text-gray-200 hover:bg-red-700 hover:text-white rounded-lg bg-red-600">
                <i class="fas fa-sign-out-alt mr-3"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>
    



    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
        <!-- Mobile Header -->
        <div class="bg-white shadow-sm p-4 flex items-center justify-between lg:hidden">
            <button id="mobile-sidebar-toggle" class="text-gray-600 hover:text-gray-900" title="Open sidebar menu">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h1 class="text-xl font-semibold">Dashboard</h1>
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mr-2">
                    <i class="fas fa-user text-gray-600"></i>
                </div>
            </div>
        </div>
        
        <!-- Content Sections -->
        <div class="p-6 flex-1">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Super Admin Management Dashboard</h1>
                    <p class="text-gray-600 mb-6">Welcome to your security management portal. Monitor and manage all security operations from here.</p>
                    
                    <!-- Use grid with main area + right side panel for notifications + calendar -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Main content (cards) spans two columns on large screens -->
                        <div class="lg:col-span-2 space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-lg bg-blue-100 text-blue-600">
                                            <i class="fas fa-user-shield text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <h2 class="text-lg font-semibold text-gray-800">245</h2>
                                            <p class="text-sm text-gray-600">Active Guards</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-lg bg-green-100 text-green-600">
                                            <i class="fas fa-building text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <h2 class="text-lg font-semibold text-gray-800">38</h2>
                                            <p class="text-sm text-gray-600">Active Clients</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-lg bg-purple-100 text-purple-600">
                                            <i class="fas fa-clipboard-list text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <h2 class="text-lg font-semibold text-gray-800">12</h2>
                                            <p class="text-sm text-gray-600">Pending Requests</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 bg-white rounded-lg shadow-sm p-6"> 
  <!-- Bulletin Board -->
<div class="flex items-center justify-between mb-4">
  <h2 class="text-xl font-semibold text-gray-800">Bulletin Board</h2>
  <!-- Create Announcement button -->
  <button id="createBulletinBtn" class="px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700">
    <i class="fa fa-plus mr-2"></i>Create Announcement
  </button>
</div>

<div class="relative overflow-hidden">
  <div id="bulletinTrack" class="flex gap-4 transition-transform duration-400">
    <!-- JS injects bulletin cards here -->
  </div>
  <div class="absolute left-2 top-1/2 -translate-y-1/2">
    <button id="bulletPrev" aria-label="Previous bulletin" class="p-2 rounded bg-white shadow">
      <i class="fas fa-chevron-left"></i>
    </button>
  </div>
  <div class="absolute right-2 top-1/2 -translate-y-1/2">
    <button id="bulletNext" aria-label="Next bulletin" class="p-2 rounded bg-white shadow">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

<!-- Create/Edit Bulletin Modal (fixed + correctly centered + scrollable) -->
<div id="createBulletinModal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="absolute inset-0 bg-black/50"></div>
  <div class="relative bg-white w-full max-w-xl mx-4 rounded-lg shadow-xl overflow-hidden z-10 max-h-[90vh]">
    <div class="p-4 border-b flex items-center justify-between">
      <h3 id="modalTitleText" class="text-lg font-semibold">Create Announcement</h3>
      <button id="closeBulletinModal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
    </div>
    <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 4rem);">
      <form id="bulletinForm" class="space-y-4">
        <div>
          <label class="text-xs font-medium text-gray-600">Title *</label>
          <input name="title" required class="w-full mt-1 px-3 py-2 border rounded bg-gray-50" />
        </div>

        <div>
          <label class="text-xs font-medium text-gray-600">Body *</label>
          <textarea name="body" rows="4" required class="w-full mt-1 px-3 py-2 border rounded bg-gray-50"></textarea>
        </div>

        <div>
          <label class="text-xs font-medium text-gray-600">Image (optional)</label>
          <div class="mt-2 flex items-start gap-3">
            <div>
              <img id="modalImagePreview" src="" alt="preview" class="w-28 h-20 object-cover rounded border bg-gray-100 hidden" />
            </div>
            <div class="flex-1">
              <input id="bulletinImageFile" type="file" accept="image/*" class="block mb-2" />
              <div class="flex items-center gap-3">
                <button type="button" id="removeImageBtn" class="text-xs px-3 py-1 rounded bg-red-100 text-red-700 hidden">Remove image</button>
                <div class="text-xs text-gray-500">Allowed: jpg/png. Small images recommended.</div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex items-center justify-end space-x-3 pt-2 border-t">
          <button type="button" id="cancelBulletin" class="px-4 py-2 rounded border">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-indigo-600 text-white">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>


  <!-- Recent Activity -->
  <h2 class="text-xl font-semibold text-gray-800 mb-4 mt-6">Recent Activity</h2>
  <div class="border-t border-gray-100 pt-4">
    <div class="flex items-start mb-4">
      <div class="bg-blue-100 p-2 rounded-full">
        <i class="fas fa-user-plus text-blue-600"></i>
      </div>
      <div class="ml-4">
        <p class="text-gray-800"><span class="font-medium">John Doe</span> registered as a new security guard</p>
        <p class="text-sm text-gray-500">2 hours ago</p>
      </div>
    </div>

    <div class="flex items-start mb-4">
      <div class="bg-green-100 p-2 rounded-full">
        <i class="fas fa-check-circle text-green-600"></i>
      </div>
      <div class="ml-4">
        <p class="text-gray-800">Shift <span class="font-medium">#3245</span> was completed successfully</p>
        <p class="text-sm text-gray-500">5 hours ago</p>
      </div>
    </div>

    <div class="flex items-start">
      <div class="bg-red-100 p-2 rounded-full">
        <i class="fas fa-exclamation-triangle text-red-600"></i>
      </div>
      <div class="ml-4">
        <p class="text-gray-800">New incident report submitted for Client #3829</p>
        <p class="text-sm text-gray-500">Yesterday at 5:30 PM</p>
      </div>
    </div>
  </div>
</div>
                        </div>

                        <!-- Right side panel: Notifications + Calendar -->
                        <aside class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Notifications</h3>
                            <ul id="notifList" class="space-y-2 max-h-40 overflow-y-auto mb-4">
                                <!-- sample notifications -->
                                <li class="p-3 rounded-lg bg-gray-50 border border-gray-100">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <div class="text-sm font-medium text-gray-800">Holiday Notice</div>
                                            <div class="text-xs text-gray-500">Office closed on Sept 25 for local holiday.</div>
                                        </div>
                                        <div class="text-xs text-gray-400 ml-3">2d</div>
                                    </div>
                                </li>
                                <li class="p-3 rounded-lg bg-gray-50 border border-gray-100">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <div class="text-sm font-medium text-gray-800">New Leave Request</div>
                                            <div class="text-xs text-gray-500">John D. submitted a leave request.</div>
                                        </div>
                                        <div class="text-xs text-gray-400 ml-3">1d</div>
                                    </div>
                                </li>
                                <li class="p-3 rounded-lg bg-gray-50 border border-gray-100">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <div class="text-sm font-medium text-gray-800">Incident Report</div>
                                            <div class="text-xs text-gray-500">Incident #234 requires review.</div>
                                        </div>
                                        <div class="text-xs text-gray-400 ml-3">3h</div>
                                    </div>
                                </li>
                            </ul>

                            <!-- Calendar -->
                            <div>
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-sm font-semibold" id="calendarMonth">Month Year</div>
                                    <div class="flex items-center space-x-2">
                                        <button id="prevMonth" class="p-2 rounded hover:bg-gray-100"><i class="fas fa-chevron-left"></i></button>
                                        <button id="nextMonth" class="p-2 rounded hover:bg-gray-100"><i class="fas fa-chevron-right"></i></button>
                                    </div>
                                </div>

                                <div class="grid calendar-grid gap-1 text-xs text-gray-600 mb-2">
                                    <div class="text-center font-medium">Sun</div>
                                    <div class="text-center font-medium">Mon</div>
                                    <div class="text-center font-medium">Tue</div>
                                    <div class="text-center font-medium">Wed</div>
                                    <div class="text-center font-medium">Thu</div>
                                    <div class="text-center font-medium">Fri</div>
                                    <div class="text-center font-medium">Sat</div>
                                </div>

                                <div id="calendarDays" class="grid calendar-grid gap-1 text-sm text-gray-700"></div>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>
            
            <!-- Other Sections (initially hidden) -->
            
            
            <!-- ACCOUNTS MANAGEMENT - Replace existing #accounts block with this -->
<div id="accounts" class="content-section">
  <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold text-gray-800">Account Management</h1>
      <div class="flex gap-2">
        <button id="accountsTabCreate" class="px-3 py-2 rounded bg-indigo-600 text-white text-sm">Create Account</button>
        <button id="accountsTabView" class="px-3 py-2 rounded bg-slate-200 text-gray-800 text-sm">View Accounts</button>
        <button id="accountsTabRemoved" class="px-3 py-2 rounded bg-slate-200 text-gray-800 text-sm">Removed Accounts</button>
      </div>
    </div>

    <!-- Create Account -->
    <div id="create-account-section" class="">
      <form id="createAccountForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-slate-600">Full Name</label>
          <input id="fullName" class="w-full px-3 py-2 rounded border bg-slate-50" required />
        </div>
        <div>
          <label class="block text-sm text-slate-600">Username</label>
          <input id="username" class="w-full px-3 py-2 rounded border bg-slate-50" required />
        </div>
        <div>
          <label class="block text-sm text-slate-600">Role</label>
          <select id="role" class="w-full px-3 py-2 rounded border bg-slate-50" required>
            <option value="">Select role</option>
            <option>Super Admin</option>
            <option>Admin</option>
            <option>HR</option>
            <option>Security Guard</option>
            <option>Head Guard</option>
            <option>Client</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-slate-600">Password</label>
          <input id="password" type="password" class="w-full px-3 py-2 rounded border bg-slate-50" required />
        </div>

        <div class="md:col-span-2 flex gap-2 mt-2">
          <button type="submit" class="px-4 py-2 rounded bg-emerald-600 text-white">Create Account</button>
          <button type="button" id="resetCreate" class="px-4 py-2 rounded bg-slate-200">Reset</button>
        </div>
      </form>
    </div>

    <!-- View Accounts -->
    <div id="view-accounts-section" class="hidden mt-6">
      <div class="flex items-center gap-3 mb-4">
        <input id="accountsSearch" placeholder="Search by name, username or role..." class="flex-1 px-3 py-2 rounded border bg-slate-50" />
        <button id="refreshAccounts" class="px-3 py-2 rounded bg-slate-100 border">Refresh</button>
      </div>

      <div class="overflow-x-auto bg-white rounded border">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-50 text-left text-slate-600">
            <tr>
              <th class="py-3 px-3">Name</th>
              <th class="py-3 px-3">Username</th>
              <th class="py-3 px-3">Role</th>
              <th class="py-3 px-3">Created</th>
              <th class="py-3 px-3">Actions</th>
            </tr>
          </thead>
          <tbody id="accountsTable" class="divide-y"></tbody>
        </table>
      </div>
    </div>

    <!-- Removed Accounts -->
    <div id="removed-accounts-section" class="hidden mt-6">
      <div class="flex items-center gap-3 mb-4">
        <input id="removedSearch" placeholder="Search removed accounts..." class="flex-1 px-3 py-2 rounded border bg-slate-50" />
      </div>

      <div class="overflow-x-auto bg-white rounded border">
        <table class="min-w-full text-sm">
<thead class="bg-slate-50 text-left text-slate-600">
  <tr>
    <th class="py-3 px-3">Login ID</th>
    <th class="py-3 px-3">Name</th>
    <th class="py-3 px-3">Username</th>
    <th class="py-3 px-3">Role</th>
    <th class="py-3 px-3">Created</th>
    <th class="py-3 px-3">Actions</th>
  </tr>
</thead>
          <tbody id="removedAccountsTable" class="divide-y"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Edit Account Modal -->
  <div id="editAccountModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
    <div class="bg-white rounded-lg max-w-lg w-full p-5">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold">Edit Account</h3>
        <button id="closeEditModal" class="text-slate-500">✕</button>
      </div>

      <form id="editAccountForm" class="space-y-3">
        <input type="hidden" id="editId" />
        <div>
          <label class="block text-sm text-slate-600">Full Name</label>
          <input id="editFullName" class="w-full px-3 py-2 rounded border bg-slate-50" />
        </div>
        <div>
          <label class="block text-sm text-slate-600">Username</label>
          <input id="editUsername" class="w-full px-3 py-2 rounded border bg-slate-50" />
        </div>
        <div>
          <label class="block text-sm text-slate-600">Role</label>
          <select id="editRole" class="w-full px-3 py-2 rounded border bg-slate-50">
            <option>Super Admin</option>
            <option>Admin</option>
            <option>HR</option>
            <option>Security Guard</option>
            <option>Head Guard</option>
            <option>Client</option>
          </select>
        </div>

        <div class="flex justify-end gap-2 mt-3">
          <button type="submit" class="px-4 py-2 rounded bg-indigo-600 text-white">Save Changes</button>
          <button type="button" id="cancelEdit" class="px-4 py-2 rounded bg-slate-200">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="changePasswordModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
    <div class="bg-white rounded-lg max-w-md w-full p-5">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold">Change Password</h3>
        <button id="closePassModal" class="text-slate-500">✕</button>
      </div>

      <form id="changePasswordForm" class="space-y-3">
        <input type="hidden" id="passUserId" />
        <div>
          <label class="block text-sm text-slate-600">New Password</label>
          <input id="newPassword" type="password" class="w-full px-3 py-2 rounded border bg-slate-50" />
        </div>
        <div>
          <label class="block text-sm text-slate-600">Confirm Password</label>
          <input id="confirmNewPassword" type="password" class="w-full px-3 py-2 rounded border bg-slate-50" />
        </div>

        <div class="flex justify-end gap-2 mt-3">
          <button type="submit" class="px-4 py-2 rounded bg-emerald-600 text-white">Change Password</button>
          <button type="button" id="cancelPass" class="px-4 py-2 rounded bg-slate-200">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>


            <!-- USER ACTIVITY (replace existing #user-activity block) -->
<div id="user-activity" class="content-section">
  <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">View User Activity</h1>
        <p class="text-gray-600">Audit trail of user actions: logins, logouts, password attempts, profile changes, etc.</p>
      </div>
      <div class="flex gap-2 items-center">
        <button id="activityExport" class="px-3 py-2 rounded bg-slate-100 border">Export (JSON)</button>
        <button id="activityRefresh" class="px-3 py-2 rounded bg-slate-100 border">Refresh</button>
      </div>
    </div>

    <!-- filters -->
    <div class="flex flex-wrap gap-3 mb-4">
      <input id="activitySearch" type="text" placeholder="Search (user, id, ip, details...)" class="flex-1 min-w-[220px] px-3 py-2 rounded border bg-slate-50" />
      <select id="activityRole" class="px-3 py-2 rounded border bg-slate-50">
        <option value="">All Roles</option>
        <option>Super Admin</option>
        <option>Admin</option>
        <option>HR</option>
        <option>Client</option>
        <option>Applicant</option>
        <option>Security Guard</option>
        <option>Head Guard</option>
      </select>
      <select id="activityUser" class="px-3 py-2 rounded border bg-slate-50">
        <option value="">All Users</option>
      </select>
      <select id="activityType" class="px-3 py-2 rounded border bg-slate-50">
        <option value="">All Types</option>
        <option>Login</option>
        <option>Logout</option>
        <option>Failed Login</option>
        <option>Password Change Attempt</option>
        <option>Password Changed</option>
        <option>Edit Profile</option>
        <option>Other</option>
      </select>
      <input id="activityFrom" type="date" class="px-3 py-2 rounded border bg-slate-50" />
      <input id="activityTo" type="date" class="px-3 py-2 rounded border bg-slate-50" />
    </div>

    <!-- table -->
    <div class="overflow-x-auto bg-white rounded border">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 text-left text-slate-600">
          <tr>
            <th class="py-3 px-3">Time</th>
            <th class="py-3 px-3">User</th>
            <th class="py-3 px-3">Role</th>
            <th class="py-3 px-3">Event</th>
            <th class="py-3 px-3">Source</th>
            <th class="py-3 px-3">Details</th>
            <th class="py-3 px-3">Actions</th>
          </tr>
        </thead>
        <tbody id="activityTable" class="divide-y"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Activity Details Modal -->
<div id="activityModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
  <div class="bg-white rounded-lg max-w-3xl w-full p-5 overflow-y-auto max-h-[90vh]">
    <div class="flex items-start justify-between mb-3">
      <h2 class="text-lg font-semibold">Activity Details</h2>
      <button id="closeActivityModal" class="text-slate-500">✕</button>
    </div>
    <div id="activityDetails" class="text-sm text-slate-700 space-y-3"></div>
    <div class="mt-4 flex justify-end gap-2">
      <button id="activityDeleteBtn" class="px-3 py-2 rounded bg-red-600 text-white">Delete</button>
      <button id="activityCloseBtn" class="px-3 py-2 rounded bg-slate-200">Close</button>
    </div>
  </div>
</div>

            <!-- Recruitment management Section -->  
            <div id="recruiting-mgmt" class="content-section">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">Recruitment Management</h1>
                    <p class="text-gray-600">Manage system notifications and alerts.</p>
                </div>
            </div>

            <!-- Messaging Section -->
<div id="messaging-mgmt" class="content-section">
  <div class="bg-white rounded-lg shadow-sm p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Messaging Management</h1>

    <!-- Sub-navigation -->
    <div class="mt-4">
      <div class="flex gap-2 mb-4">
        <button id="inboxBtn" class="px-3 py-2 rounded bg-indigo-600 text-white text-sm">Inbox</button>
        <button id="composeBtn" class="px-3 py-2 rounded bg-slate-200 text-gray-800 text-sm">Compose</button>
      </div>

      <!-- Inbox Section -->
      <div id="inbox-section" class="bg-white rounded-lg shadow-sm p-4">
        <div class="flex items-center gap-3 mb-4">
          <input type="text" id="messageSearch" placeholder="Search messages..." class="flex-1 px-3 py-2 rounded border bg-slate-50" />
          <button id="refreshBtn" class="px-3 py-2 rounded bg-slate-100 border">Refresh</button>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-slate-500">
              <tr>
                <th class="py-2">Sender</th>
                <th class="py-2">Subject</th>
                <th class="py-2">Date</th>
                <th class="py-2">Action</th>
              </tr>
            </thead>
            <tbody id="messageTable" class="divide-y">
              <!-- Example row -->
              <tr>
                <td class="py-2">Admin</td>
                <td class="py-2">Welcome to SeekYu</td>
                <td class="py-2">2025-09-13</td>
                <td class="py-2">
                  <button class="viewBtn text-blue-600 hover:underline" 
                    data-sender="Admin" 
                    data-recipient="You" 
                    data-subject="Welcome to SeekYu" 
                    data-date="2025-09-13" 
                    data-body="This is a sample welcome message.">View</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Compose Section -->
      <div id="compose-section" class="hidden bg-white rounded-lg shadow-sm p-4 mt-4">
        <form id="composeForm" class="space-y-3">
          <div>
            <label class="block text-sm text-slate-600">To:</label>
            <input type="text" id="recipient" name="recipient" required class="w-full px-3 py-2 rounded border bg-slate-50" />
          </div>

          <div>
            <label class="block text-sm text-slate-600">Subject:</label>
            <input type="text" id="subject" name="subject" required class="w-full px-3 py-2 rounded border bg-slate-50" />
          </div>

          <div>
            <label class="block text-sm text-slate-600">Message:</label>
            <textarea id="message" name="message" rows="5" required class="w-full px-3 py-2 rounded border bg-slate-50"></textarea>
          </div>

          <div class="flex gap-2">
            <button type="submit" class="px-4 py-2 rounded bg-indigo-600 text-white">Send Message</button>
            <button type="button" id="cancelCompose" class="px-4 py-2 rounded bg-slate-200">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
            <!-- Edit Profile Modal (simplified: full name, email, phone, avatar) -->
    <div id="editProfileModal" class="fixed inset-0 hidden items-center justify-center z-50">
        <div class="modal-backdrop absolute inset-0"></div>
        <div class="relative bg-white w-full max-w-2xl mx-4 rounded-lg shadow-xl overflow-hidden">
            <div class="p-4 border-b flex items-center justify-between">
                <h3 class="text-lg font-semibold">Edit Profile (HR)</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <form id="profileForm" class="space-y-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <img id="modalAvatar" src="https://i.pravatar.cc/100?img=3" class="w-20 h-20 rounded-full object-cover border" alt="avatar"/>
                            <div class="mt-2">
                                <input id="modalFile" type="file" accept="image/*" class="hidden" />
                                <button type="button" id="changeAvatarBtn" class="text-xs px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 mt-2"><i class="fas fa-image mr-1"></i> Change</button>
                            </div>
                        </div>

                        <div class="flex-1 grid grid-cols-2 gap-3">
                            <div class="col-span-2">
                                <label class="text-xs font-medium text-gray-600">Full name *</label>
                                <input id="inputFullName" required class="w-full mt-1 px-3 py-2 border rounded bg-gray-50" />
                            </div>

                            <div>
                                <label class="text-xs font-medium text-gray-600">Email *</label>
                                <input id="inputEmail" type="email" required class="w-full mt-1 px-3 py-2 border rounded bg-gray-50" />
                            </div>

                            <div>
                                <label class="text-xs font-medium text-gray-600">Phone</label>
                                <input id="inputPhone" class="w-full mt-1 px-3 py-2 border rounded bg-gray-50" />
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-end space-x-3 pt-2 border-t">
                        <button type="button" id="cancelProfile" class="px-4 py-2 rounded border">Cancel</button>
                        <button type="submit" id="saveProfile" class="px-4 py-2 rounded bg-blue-600 text-white">Save Profile</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
<!-- Popup for Viewing Message -->
<div id="message-popup" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
  <div class="bg-white rounded-lg max-w-lg w-full p-5">
    <div class="flex items-start justify-between mb-3">
      <h2 class="text-lg font-semibold">Message Details</h2>
      <button id="closePopup" class="text-slate-500 hover:text-slate-800">✕</button>
    </div>

    <p class="text-sm"><strong>From:</strong> <span id="popupSender">-</span></p>
    <p class="text-sm"><strong>To:</strong> <span id="popupRecipient">-</span></p>
    <p class="text-sm"><strong>Subject:</strong> <span id="popupSubject">-</span></p>
    <p class="text-sm"><strong>Date:</strong> <span id="popupDate">-</span></p>

    <div class="mt-3">
      <p id="popupBody" class="whitespace-pre-wrap text-sm text-slate-700"></p>
    </div>

    <div class="mt-4 flex gap-2 justify-end">
      <button id="replyBtn" class="px-3 py-2 rounded bg-emerald-600 text-white">Reply</button>
      <button id="deleteBtn" class="px-3 py-2 rounded bg-red-600 text-white">Delete</button>
      <button id="closePopup2" class="px-3 py-2 rounded bg-slate-200">Close</button>
    </div>
  </div>
</div>

            <!-- Notification Section -->  
            <div id="notification" class="content-section">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">Notifications</h1>
                    <p class="text-gray-600">Manage system notifications and alerts.</p>
                </div>
            </div>
            <!-- Add other sections similarly -->
            
        </div>
    </div>
<!-- Popup Modal -->
<div id="popup-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
    <div class="p-6">
      <h3 class="text-xl font-semibold text-gray-800" id="popup-title">Popup Title</h3>
      <p class="text-gray-600 mt-2" id="popup-content">This is the popup content. You can put any information here.</p>
    </div>
    <div class="flex justify-end p-6 border-t border-gray-200">
      <button id="close-popup" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Close</button>
    </div>
  </div>
</div>

<!-- Replace your existing <script>...</script> with this block -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Sidebar mobile toggle (kept similar to your original)
  const mobileToggle = document.getElementById('mobile-sidebar-toggle');
  mobileToggle?.addEventListener('click', function() {
    const sidebar = document.querySelector('.sidebar');
    sidebar.classList.toggle('-ml-64');
    sidebar.classList.toggle('ml-0');
    const toggleIcon = document.querySelector('#sidebar-toggle i');
    if (sidebar.classList.contains('-ml-64')) {
      toggleIcon.classList.remove('fa-times'); toggleIcon.classList.add('fa-bars');
    } else {
      toggleIcon.classList.remove('fa-bars'); toggleIcon.classList.add('fa-times');
    }
  });

  // --- Section switching (keeps your showSection logic but safer) ---
  window.showSection = function(sectionId, clickedBtn = null) {
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));

    const target = document.getElementById(sectionId);
    if (target) target.classList.add('active');

    // mark button active if provided
    if (clickedBtn) clickedBtn.classList.add('active');

    if (window.innerWidth < 1024) {
      document.querySelector('.sidebar')?.classList.add('-ml-64');
      const icon = document.querySelector('#sidebar-toggle i');
      if (icon) { icon.classList.remove('fa-times'); icon.classList.add('fa-bars'); }
    }
  };

}); // <-- Add this closing brace for document.addEventListener
// --- Messaging Section Logic ---
  // If sidebar buttons use inline onclick (your layout), ensure the Messaging button opens inbox first
  const messagingSidebarBtn = Array.from(document.querySelectorAll('button')).find(b => b.getAttribute('onclick')?.includes("showSection('messaging-mgmt')"));
  if (messagingSidebarBtn) {
    messagingSidebarBtn.addEventListener('click', function (ev) {
      // use the safer showSection, and pass the clicked button to be marked active
      showSection('messaging-mgmt', messagingSidebarBtn);
      showInbox();
    });
  }

  // --- Messaging UI elements ---
  const inboxBtn = document.getElementById('inboxBtn');
  const composeBtn = document.getElementById('composeBtn');
  const inboxSection = document.getElementById('inbox-section');
  const composeSection = document.getElementById('compose-section');
  const cancelCompose = document.getElementById('cancelCompose');
  const composeForm = document.getElementById('composeForm');
  const messageTable = document.getElementById('messageTable');
  const messagePopup = document.getElementById('message-popup');
  const popupSender = document.getElementById('popupSender');
  const popupRecipient = document.getElementById('popupRecipient');
  const popupSubject = document.getElementById('popupSubject');
  const popupDate = document.getElementById('popupDate');
  const popupBody = document.getElementById('popupBody');
  const replyBtn = document.getElementById('replyBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const closePopupBtns = [document.getElementById('closePopup'), document.getElementById('closePopup2')];

  // In-memory messages store for frontend demo (id increments)
  let messages = [
    {
      id: 1,
      sender: 'Admin',
      recipient: 'You',
      subject: 'Welcome to SeekYu',
      date: '2025-09-13',
      body: 'This is a sample welcome message.'
    }
  ];
  let nextMessageId = 2;
  let currentViewedMessageId = null; // id of message currently shown in popup

  function renderInbox() {
    messageTable.innerHTML = '';
    for (const msg of messages.slice().reverse()) { // show newest first
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="py-2">${escapeHtml(msg.sender)}</td>
        <td class="py-2">${escapeHtml(msg.subject)}</td>
        <td class="py-2">${escapeHtml(msg.date)}</td>
        <td class="py-2">
          <button class="viewBtn text-blue-600 hover:underline" data-id="${msg.id}">View</button>
          <button class="delInlineBtn ml-3 text-red-600 hover:underline" data-id="${msg.id}">Delete</button>
        </td>`;
      messageTable.appendChild(tr);
    }
  }

  // Simple HTML escape
  function escapeHtml(s) {
    if (!s && s !== 0) return '';
    return String(s).replace(/[&<>"'`=\/]/g, function(ch) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#47;','`':'&#96;','=':'&#61;'}[ch];
    });
  }

  // Inbox/Compose toggles
  function showInbox() {
    inboxSection.classList.remove('hidden');
    composeSection.classList.add('hidden');
    inboxBtn.classList.add('bg-indigo-600','text-white');
    inboxBtn.classList.remove('bg-slate-200','text-gray-800');
    composeBtn.classList.remove('bg-indigo-600','text-white');
    composeBtn.classList.add('bg-slate-200','text-gray-800');
  }
  function showCompose() {
    composeSection.classList.remove('hidden');
    inboxSection.classList.add('hidden');
    composeBtn.classList.add('bg-indigo-600','text-white');
    composeBtn.classList.remove('bg-slate-200','text-gray-800');
    inboxBtn.classList.remove('bg-indigo-600','text-white');
    inboxBtn.classList.add('bg-slate-200','text-gray-800');
  }
  inboxBtn?.addEventListener('click', showInbox);
  composeBtn?.addEventListener('click', showCompose);
  cancelCompose?.addEventListener('click', showInbox);

  // Open a message in popup (delegated)
  document.addEventListener('click', function(e) {
    // view inline from table
    if (e.target && e.target.classList.contains('viewBtn')) {
      const id = Number(e.target.dataset.id);
      const msg = messages.find(m => m.id === id);
      if (!msg) return;
      currentViewedMessageId = id;
      popupSender.textContent = msg.sender;
      popupRecipient.textContent = msg.recipient;
      popupSubject.textContent = msg.subject;
      popupDate.textContent = msg.date;
      popupBody.textContent = msg.body;
      messagePopup.classList.remove('hidden');
    }

    // inline delete button in table (asks confirm)
    if (e.target && e.target.classList.contains('delInlineBtn')) {
      const id = Number(e.target.dataset.id);
      if (!confirm('Delete this message?')) return;
      messages = messages.filter(m => m.id !== id);
      renderInbox();
      // if deleted message is currently open in popup, close popup
      if (currentViewedMessageId === id) {
        currentViewedMessageId = null;
        messagePopup.classList.add('hidden');
      }
    }
  });

  // Reply button: prefill compose form and open compose
  replyBtn?.addEventListener('click', function() {
    if (!currentViewedMessageId) return;
    const msg = messages.find(m => m.id === currentViewedMessageId);
    if (!msg) return;
    // open messaging section and compose
    showSection('messaging-mgmt');
    showCompose();

    // prefill
    const recipientInput = document.getElementById('recipient');
    const subjectInput = document.getElementById('subject');
    const bodyTextarea = document.getElementById('message');

    if (recipientInput) recipientInput.value = msg.sender || '';
    if (subjectInput) {
      // if subject already starts with Re:, keep it
      subjectInput.value = msg.subject && !/^Re:/i.test(msg.subject) ? `Re: ${msg.subject}` : msg.subject || '';
    }
    if (bodyTextarea) {
      bodyTextarea.value = `\n\n--- Original Message ---\nFrom: ${msg.sender}\nDate: ${msg.date}\nSubject: ${msg.subject}\n\n${msg.body}`;
      bodyTextarea.focus();
      // put cursor at start of textarea for user to type reply
      bodyTextarea.setSelectionRange(0, 0);
    }

    // close popup after replying to reduce UI noise
    messagePopup.classList.add('hidden');
  });

  // Delete button (from popup) - removes the message and closes popup
  deleteBtn?.addEventListener('click', function() {
    if (!currentViewedMessageId) return;
    if (!confirm('Delete this message? This cannot be undone in this demo.')) return;
    messages = messages.filter(m => m.id !== currentViewedMessageId);
    currentViewedMessageId = null;
    messagePopup.classList.add('hidden');
    renderInbox();
  });

  // Close popup buttons
  closePopupBtns.forEach(btn => btn?.addEventListener('click', function(){ messagePopup.classList.add('hidden'); currentViewedMessageId = null; }));

  // Clicking outside popup content closes it
  messagePopup?.addEventListener('click', function(e) {
    if (e.target === messagePopup) {
      messagePopup.classList.add('hidden');
      currentViewedMessageId = null;
    }
  });

  // Compose handler (frontend-only simulation)
  composeForm?.addEventListener('submit', function(e) {
    e.preventDefault();
    const recipient = document.getElementById('recipient').value.trim();
    const subject = document.getElementById('subject').value.trim();
    const body = document.getElementById('message').value.trim();
    if (!recipient || !subject || !body) {
      alert('Please fill out all fields.');
      return;
    }
    const newMsg = {
      id: nextMessageId++,
      sender: 'You', // outgoing: from current user
      recipient,
      subject,
      date: new Date().toISOString().split('T')[0],
      body
    };
    // For demo, add to messages store (so it appears in inbox)
    messages.push(newMsg);
    renderInbox();
    // Reset form and show inbox
    composeForm.reset();
    showInbox();
    alert('Message sent (demo mode). In a real app this would call your backend API.');
  });

  // initial render: show inbox first
  renderInbox();
  showInbox();

  // Utility: refresh button (just re-render here)
  document.getElementById('refreshBtn')?.addEventListener('click', function(){ renderInbox(); });

  // Search (very basic filter by subject/sender)
  document.getElementById('messageSearch')?.addEventListener('input', function() {
    const q = this.value.trim().toLowerCase();
    const rows = messageTable.querySelectorAll('tr');
    rows.forEach(r => {
      const txt = r.textContent.toLowerCase();
      r.style.display = txt.includes(q) ? '' : 'none';
    });
  });


// accounts management logic
(function(){
  // Elements (same IDs as in the HTML you already have)
  const createForm = document.getElementById('createAccountForm');
  const accountsTable = document.getElementById('accountsTable');
  const removedTable = document.getElementById('removedAccountsTable');
  const accountsSearch = document.getElementById('accountsSearch');
  const removedSearch = document.getElementById('removedSearch');
  const refreshAccounts = document.getElementById('refreshAccounts');

  const editModal = document.getElementById('editAccountModal');
  const editForm = document.getElementById('editAccountForm');
  const closeEditModal = document.getElementById('closeEditModal');
  const cancelEdit = document.getElementById('cancelEdit');

  const passModal = document.getElementById('changePasswordModal');
  const passForm = document.getElementById('changePasswordForm');
  const closePassModal = document.getElementById('closePassModal');
  const cancelPass = document.getElementById('cancelPass');

  const tabCreate = document.getElementById('accountsTabCreate');
  const tabView = document.getElementById('accountsTabView');
  const tabRemoved = document.getElementById('accountsTabRemoved');
  const createSection = document.getElementById('create-account-section');
  const viewSection = document.getElementById('view-accounts-section');
  const removedSection = document.getElementById('removed-accounts-section');
  const resetCreate = document.getElementById('resetCreate');

  // In-memory stores
  // account object shape:
  // { id: number, accountId: 'ADM-0001', fullName, username, role, password, createdAt }
  let accounts = [
    { id: 1, accountId: 'ADM-0001', fullName: 'Jane Admin', username: 'jane.admin', role: 'Admin', password: 'admin123', createdAt: '2025-09-13' }
  ];
  let removedAccounts = []; // { id, accountId, fullName, username, role, password, createdAt, removedAt }
  let nextAccountId = 2;

  // mapping for prefixes
  const rolePrefixes = {
    'Admin': 'ADM',
    'HR': 'HR',
    'Security Guard': 'SG',
    'Head Guard': 'HG',
    'Client': 'CL'
  };

  // utils
  function today() { return new Date().toISOString().split('T')[0]; }
  function padNum(n, size=4) { return String(n).padStart(size,'0'); }
  function genAccountId(role, seq) {
    const pref = rolePrefixes[role] || 'USR';
    return `${pref}-${padNum(seq)}`;
  }
  function escapeHtml(s){ if (!s && s !== 0) return ''; return String(s).replace(/[&<>"'`=\/]/g, function(ch){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#47;','`':'&#96;','=':'&#61;'}[ch]; }); }

  // Render functions
  function renderAccounts(filter = '') {
    accountsTable.innerHTML = '';
    const rows = accounts.filter(a => {
      const q = filter.toLowerCase();
      return !q || (a.accountId + ' ' + a.fullName + ' ' + a.username + ' ' + a.role).toLowerCase().includes(q);
    });

    if (rows.length === 0) {
      accountsTable.innerHTML = '<tr><td class="py-4 px-3 text-slate-500" colspan="6">No accounts found.</td></tr>';
      return;
    }

    for (const a of rows) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="py-3 px-3 font-mono text-sm">${escapeHtml(a.accountId)}</td>
        <td class="py-3 px-3">${escapeHtml(a.fullName)}</td>
        <td class="py-3 px-3">${escapeHtml(a.username)}</td>
        <td class="py-3 px-3">${escapeHtml(a.role)}</td>
        <td class="py-3 px-3">${escapeHtml(a.createdAt)}</td>
        <td class="py-3 px-3">
          <button class="editBtn text-indigo-600 hover:underline" data-id="${a.id}">Edit</button>
          <button class="passBtn ml-3 text-sky-600 hover:underline" data-id="${a.id}">Change Password</button>
          <button class="removeBtn ml-3 text-red-600 hover:underline" data-id="${a.id}">Remove</button>
        </td>
      `;
      accountsTable.appendChild(tr);
    }
  }

  function renderRemovedAccounts(filter = '') {
    removedTable.innerHTML = '';
    const rows = removedAccounts.filter(a => {
      const q = filter.toLowerCase();
      return !q || (a.accountId + ' ' + a.fullName + ' ' + a.username + ' ' + a.role).toLowerCase().includes(q);
    });

    if (rows.length === 0) {
      removedTable.innerHTML = '<tr><td class="py-4 px-3 text-slate-500" colspan="6">No removed accounts.</td></tr>';
      return;
    }

    for (const a of rows) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="py-3 px-3 font-mono text-sm">${escapeHtml(a.accountId)}</td>
        <td class="py-3 px-3">${escapeHtml(a.fullName)}</td>
        <td class="py-3 px-3">${escapeHtml(a.username)}</td>
        <td class="py-3 px-3">${escapeHtml(a.role)}</td>
        <td class="py-3 px-3">${escapeHtml(a.removedAt)}</td>
        <td class="py-3 px-3">
          <button class="restoreBtn text-emerald-600 hover:underline" data-id="${a.id}">Restore</button>
          <button class="permaDelBtn ml-3 text-red-700 hover:underline" data-id="${a.id}">Permanently Delete</button>
        </td>
      `;
      removedTable.appendChild(tr);
    }
  }

  // Initial render
  renderAccounts();
  renderRemovedAccounts();

  // TAB handlers
  function activateTab(tab) {
    [tabCreate, tabView, tabRemoved].forEach(t => t.classList.remove('bg-indigo-600','text-white'));
    [tabCreate, tabView, tabRemoved].forEach(t => t.classList.add('bg-slate-200','text-gray-800'));
    tab.classList.remove('bg-slate-200','text-gray-800');
    tab.classList.add('bg-indigo-600','text-white');

    createSection.classList.add('hidden');
    viewSection.classList.add('hidden');
    removedSection.classList.add('hidden');

    if (tab === tabCreate) createSection.classList.remove('hidden');
    if (tab === tabView) viewSection.classList.remove('hidden');
    if (tab === tabRemoved) removedSection.classList.remove('hidden');
  }

  tabCreate.addEventListener('click', () => activateTab(tabCreate));
  tabView.addEventListener('click', () => activateTab(tabView));
  tabRemoved.addEventListener('click', () => activateTab(tabRemoved));

  // Default: show create
  activateTab(tabCreate);

  // Create account: now generates accountId
  createForm.addEventListener('submit', function(e){
    e.preventDefault();
    const fullName = document.getElementById('fullName').value.trim();
    const username = document.getElementById('username').value.trim();
    const role = document.getElementById('role').value;
    const password = document.getElementById('password').value;

    if (!fullName || !username || !role || !password) {
      alert('Please fill out all fields.');
      return;
    }

    // Generate accountId from role prefix + sequence
    const accountId = genAccountId(role, nextAccountId);

    // ensure unique accountId / username (demo)
    if (accounts.some(a => a.username === username) || removedAccounts.some(a => a.username === username)) {
      alert('Username already exists. Choose another one.');
      return;
    }
    if (accounts.some(a => a.accountId === accountId) || removedAccounts.some(a => a.accountId === accountId)) {
      // unlikely as we use incremental, but handle it
      nextAccountId++;
      alert('ID collision, generating a different ID. Please submit again.');
      return;
    }

    const newAcc = { id: nextAccountId++, accountId, fullName, username, role, password, createdAt: today() };
    accounts.push(newAcc);
    renderAccounts();
    createForm.reset();
    // show the login credentials clearly to the admin
    alert(`Account created (demo).\nLogin ID: ${accountId}\nPassword: (the one you entered)\n\nIMPORTANT: Share the Login ID with the user. In production, send this via secure channel.`);
    // optionally switch to view tab
    activateTab(tabView);
  });

  resetCreate.addEventListener('click', function(){ createForm.reset(); });

  // Table action delegation for accounts (edit, change pass, remove)
  document.addEventListener('click', function(e){
    if (e.target.matches('.editBtn')) {
      const id = Number(e.target.dataset.id);
      const a = accounts.find(x => x.id === id);
      if (!a) return;
      document.getElementById('editId').value = a.id;
      document.getElementById('editFullName').value = a.fullName;
      document.getElementById('editUsername').value = a.username;
      document.getElementById('editRole').value = a.role;
      editModal.classList.remove('hidden');
    }

    if (e.target.matches('.passBtn')) {
      const id = Number(e.target.dataset.id);
      document.getElementById('passUserId').value = id;
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmNewPassword').value = '';
      passModal.classList.remove('hidden');
    }

    if (e.target.matches('.removeBtn')) {
      const id = Number(e.target.dataset.id);
      if (!confirm('Move this account to Removed (Trash)?')) return;
      const idx = accounts.findIndex(x => x.id === id);
      if (idx === -1) return;
      const removed = accounts.splice(idx,1)[0];
      removed.removedAt = today();
      removedAccounts.push(removed);
      renderAccounts();
      renderRemovedAccounts();
    }

    // Removed table actions
    if (e.target.matches('.restoreBtn')) {
      const id = Number(e.target.dataset.id);
      const idx = removedAccounts.findIndex(x => x.id === id);
      if (idx === -1) return;
      const restored = removedAccounts.splice(idx,1)[0];
      delete restored.removedAt;
      accounts.push(restored);
      renderAccounts();
      renderRemovedAccounts();
    }

    if (e.target.matches('.permaDelBtn')) {
      const id = Number(e.target.dataset.id);
      if (!confirm('Permanently delete this account? This cannot be undone.')) return;
      const idx = removedAccounts.findIndex(x => x.id === id);
      if (idx === -1) return;
      removedAccounts.splice(idx,1);
      renderRemovedAccounts();
    }
  });

  // Edit form submit
  editForm.addEventListener('submit', function(e){
    e.preventDefault();
    const id = Number(document.getElementById('editId').value);
    const fullName = document.getElementById('editFullName').value.trim();
    const username = document.getElementById('editUsername').value.trim();
    const role = document.getElementById('editRole').value;

    const acc = accounts.find(a => a.id === id);
    if (!acc) { alert('Account not found'); return; }

    // ensure username unique among accounts and removed (except self)
    if ((accounts.some(a => a.username === username && a.id !== id)) || (removedAccounts.some(a => a.username === username))) {
      alert('Username already taken.');
      return;
    }

    acc.fullName = fullName;
    acc.username = username;
    acc.role = role;
    // NOTE: accountId stays unchanged here to preserve login credentials
    renderAccounts();
    editModal.classList.add('hidden');
  });

  closeEditModal.addEventListener('click', ()=> editModal.classList.add('hidden'));
  cancelEdit.addEventListener('click', ()=> editModal.classList.add('hidden'));

  // Change password submit
  passForm.addEventListener('submit', function(e){
    e.preventDefault();
    const id = Number(document.getElementById('passUserId').value);
    const p1 = document.getElementById('newPassword').value;
    const p2 = document.getElementById('confirmNewPassword').value;
    if (!p1 || !p2) { alert('Enter the new password in both fields.'); return; }
    if (p1 !== p2) { alert('Passwords do not match'); return; }
    const acc = accounts.find(a => a.id === id);
    if (!acc) { alert('Account not found'); return; }
    acc.password = p1; // demo only
    passModal.classList.add('hidden');
    alert('Password changed (demo mode). In production, call your backend API and hash passwords.');
  });

  closePassModal.addEventListener('click', ()=> passModal.classList.add('hidden'));
  cancelPass.addEventListener('click', ()=> passModal.classList.add('hidden'));

  // Search handlers
  accountsSearch?.addEventListener('input', function(){ renderAccounts(this.value || ''); });
  removedSearch?.addEventListener('input', function(){ renderRemovedAccounts(this.value || ''); });
  refreshAccounts?.addEventListener('click', function(){ renderAccounts(); });

  // Optional: Expose functions for backend wiring
  window.AccountsDemo = {
    getAccounts: ()=> accounts,
    getRemoved: ()=> removedAccounts,
    render: ()=> { renderAccounts(); renderRemovedAccounts(); }
  };

})();

/* User Activity module (localStorage-backed demo)
   - exposes window.UserActivity.add(log)
   - log shape: { id, timeISO, userId, accountId, name, role, type, source (IP/UA), details }
*/
(function(){
  const STORAGE_KEY = 'seekyu_user_activity_v1';
  // demo current user for "privileged" actions if needed
  const currentUser = window.loggedUser || { id: 1, name: 'Alice Admin', role: 'Admin', accountId: 'ADM-0001' };

  // DOM
  const el = id => document.getElementById(id);
  const activityTable = el('activityTable'), activitySearch = el('activitySearch'),
        activityRole = el('activityRole'), activityUser = el('activityUser'),
        activityType = el('activityType'), activityFrom = el('activityFrom'),
        activityTo = el('activityTo'), activityRefresh = el('activityRefresh'),
        activityExport = el('activityExport'),
        activityModal = el('activityModal'), activityDetails = el('activityDetails'),
        closeActivityModal = el('closeActivityModal'), activityCloseBtn = el('activityCloseBtn'),
        activityDeleteBtn = el('activityDeleteBtn');

  function load() {
    try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : []; }
    catch(e){ console.warn('Failed to load activity', e); return []; }
  }
  function save(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

  let logs = load();

  // seed sample logs if empty (helps demo)
  if (!logs || logs.length === 0) {
    logs = [
      { id: 'ACT-0001', timeISO: '2025-09-13T08:12:00Z', userId: 42, accountId: 'SG-1001', name: 'John Guard', role: 'Security Guard', type: 'Login', source: '192.168.1.10', details: 'Successful login' },
      { id: 'ACT-0002', timeISO: '2025-09-13T17:05:00Z', userId: 42, accountId: 'SG-1001', name: 'John Guard', role: 'Security Guard', type: 'Logout', source: '192.168.1.10', details: 'User logged out' },
      { id: 'ACT-0003', timeISO: '2025-09-12T09:00:00Z', userId: 2, accountId: 'ADM-0001', name: 'Alice Admin', role: 'Admin', type: 'Password Change Attempt', source: '10.0.0.5', details: 'Changed password successfully' },
      { id: 'ACT-0004', timeISO: '2025-09-14T07:11:00Z', userId: 99, accountId: 'CL-2001', name: 'Client Bob', role: 'Client', type: 'Failed Login', source: '203.0.113.7', details: 'Incorrect password attempts: 3' }
    ];
    save(logs);
  }

  // helpers
  function pad(n) { return String(n).padStart(3,'0'); }
  function genId() { const seq = (logs.length ? logs.reduce((m,x)=>Math.max(m, Number((x.id || '').replace(/\D/g,'' )||0)),0) : 0) + 1; return 'ACT-' + String(seq).padStart(4,'0'); }
  function fmtDate(iso) {
    if (!iso) return '';
    const d = new Date(iso);
    if (isNaN(d)) return iso;
    return d.toLocaleString();
  }
  function escapeHtml(s){ if (!s && s!==0) return ''; return String(s).replace(/[&<>"'`=\/]/g, function(ch){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#47;','`':'&#96;','=':'&#61;'}[ch]; }); }

  // populate user select with unique users present
  function populateUsers() {
    if (!activityUser) return;
    const uniq = {};
    logs.forEach(l => { const key = (l.accountId||'') + '|' + (l.name||''); uniq[key] = l; });
    const opts = [{val:'', text: 'All Users'}].concat(Object.values(uniq).map(u => ({ val: u.accountId, text: `${u.name} — ${u.accountId}` })));
    activityUser.innerHTML = opts.map(o => `<option value="${escapeHtml(o.val)}">${escapeHtml(o.text)}</option>`).join('');
  }

  function render() {
    if (!activityTable) return;
    activityTable.innerHTML = '';
    const q = (activitySearch && activitySearch.value || '').toLowerCase();
    const role = (activityRole && activityRole.value) || '';
    const user = (activityUser && activityUser.value) || '';
    const type = (activityType && activityType.value) || '';
    const from = (activityFrom && activityFrom.value) || '';
    const to = (activityTo && activityTo.value) || '';

    const filtered = logs.slice().reverse().filter(l => {
      if (role && l.role !== role) return false;
      if (user && l.accountId !== user) return false;
      if (type && l.type !== type) return false;
      if (from && l.timeISO && l.timeISO < (from + 'T00:00:00')) return false;
      if (to && l.timeISO && l.timeISO > (to + 'T23:59:59')) return false;
      if (!q) return true;
      const hay = `${l.id} ${l.accountId} ${l.name} ${l.role} ${l.type} ${l.source} ${l.details}`.toLowerCase();
      return hay.includes(q);
    });

    if (filtered.length === 0) {
      activityTable.innerHTML = '<tr><td class="py-4 px-3 text-slate-500" colspan="7">No activity logs found.</td></tr>';
      return;
    }

    for (const a of filtered) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="py-2 px-3 font-mono text-sm">${escapeHtml(fmtDate(a.timeISO))}</td>
        <td class="py-2 px-3">${escapeHtml(a.name)}<div class="text-xs text-slate-400">${escapeHtml(a.accountId)}</div></td>
        <td class="py-2 px-3">${escapeHtml(a.role)}</td>
        <td class="py-2 px-3">${escapeHtml(a.type)}</td>
        <td class="py-2 px-3">${escapeHtml(a.source || '')}</td>
        <td class="py-2 px-3 max-w-xl"><div class="truncate" title="${escapeHtml(a.details || '')}">${escapeHtml(a.details || '')}</div></td>
        <td class="py-2 px-3">
          <button class="viewActivityBtn text-blue-600 hover:underline" data-id="${escapeHtml(a.id)}">View</button>
          <button class="delActivityBtn ml-3 text-red-600 hover:underline" data-id="${escapeHtml(a.id)}">Delete</button>
        </td>`;
      activityTable.appendChild(tr);
    }
  }

  // view modal
  let activeId = null;
  function openModal(id) {
    const log = logs.find(x => x.id === id);
    if (!log) return alert('Log not found.');
    activeId = id;
    if (!activityDetails) return;
    activityDetails.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div><strong>Activity ID:</strong> ${escapeHtml(log.id)}</div>
        <div><strong>Time:</strong> ${escapeHtml(fmtDate(log.timeISO))}</div>
        <div><strong>User:</strong> ${escapeHtml(log.name)} (${escapeHtml(log.accountId)})</div>
        <div><strong>Role:</strong> ${escapeHtml(log.role)}</div>
        <div><strong>Event Type:</strong> ${escapeHtml(log.type)}</div>
        <div><strong>Source (IP/UA):</strong> ${escapeHtml(log.source||'')}</div>
      </div>
      <hr class="my-3" />
      <div><strong>Details:</strong><div class="mt-1 whitespace-pre-wrap text-slate-700">${escapeHtml(log.details||'')}</div></div>
    `;
    activityModal.classList.remove('hidden');
  }
  function closeModal() { activityModal.classList.add('hidden'); activeId = null; }

  // delete active
  function deleteActive() {
    if (!activeId) return;
    if (!confirm('Delete this activity log?')) return;
    logs = logs.filter(x => x.id !== activeId);
    save(logs);
    populateUsers();
    render();
    closeModal();
  }

  // export filtered
  function exportFiltered() {
    // reuse render filter logic to produce exported array
    const q = (activitySearch && activitySearch.value || '').toLowerCase();
    const role = (activityRole && activityRole.value) || '';
    const user = (activityUser && activityUser.value) || '';
    const type = (activityType && activityType.value) || '';
    const from = (activityFrom && activityFrom.value) || '';
    const to = (activityTo && activityTo.value) || '';

    const filtered = logs.slice().reverse().filter(l => {
      if (role && l.role !== role) return false;
      if (user && l.accountId !== user) return false;
      if (type && l.type !== type) return false;
      if (from && l.timeISO && l.timeISO < (from + 'T00:00:00')) return false;
      if (to && l.timeISO && l.timeISO > (to + 'T23:59:59')) return false;
      if (!q) return true;
      const hay = `${l.id} ${l.accountId} ${l.name} ${l.role} ${l.type} ${l.source} ${l.details}`.toLowerCase();
      return hay.includes(q);
    });

    const blob = new Blob([JSON.stringify(filtered, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `user-activity-${new Date().toISOString().slice(0,10)}.json`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // delegation listeners
  document.addEventListener('click', function(e){
    const t = e.target;
    if (!t) return;
    if (t.matches('.viewActivityBtn')) { openModal(t.dataset.id); }
    if (t.matches('.delActivityBtn')) {
      const id = t.dataset.id;
      if (!confirm('Delete this activity log?')) return;
      logs = logs.filter(x => x.id !== id);
      save(logs);
      populateUsers();
      render();
    }
  });

  // modal controls
  if (closeActivityModal) closeActivityModal.addEventListener('click', closeModal);
  if (activityCloseBtn) activityCloseBtn.addEventListener('click', closeModal);
  if (activityModal) activityModal.addEventListener('click', function(e){ if (e.target === activityModal) closeModal(); });
  if (activityDeleteBtn) activityDeleteBtn.addEventListener('click', deleteActive);

  // filters
  [activitySearch, activityRole, activityUser, activityType, activityFrom, activityTo].forEach(elm=>{
    if (!elm) return;
    elm.addEventListener('input', render);
  });
  if (activityRefresh) activityRefresh.addEventListener('click', function(){ logs = load(); populateUsers(); render(); });
  if (activityExport) activityExport.addEventListener('click', exportFiltered);

  // initial UI setup
  populateUsers();
  render();

  // public helper to add activity entries (other parts of app can call this)
  window.UserActivity = {
    add: function(payload){
      // payload minimal shape: { timeISO, userId, accountId, name, role, type, source, details }
      const entry = Object.assign({
        id: genId(),
        timeISO: new Date().toISOString(),
        userId: payload.userId || null,
        accountId: payload.accountId || '',
        name: payload.name || '',
        role: payload.role || '',
        type: payload.type || 'Other',
        source: payload.source || '',
        details: payload.details || ''
      }, payload);
      logs.push(entry);
      save(logs);
      populateUsers();
      render();
      return entry;
    },
    all: function(){ return logs.slice(); }
  };

})();

</script>
</body>
</html>
